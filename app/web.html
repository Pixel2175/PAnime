<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PAnime - Arabic Anime Streaming</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6366f1',
            secondary: '#8b5cf6',
            accent: '#06b6d4',
          }
        }
      }
    }
  </script>
</head>

<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 text-white min-h-screen">
  <div id="app">
    <!-- Header -->
    <header class="bg-black/30 backdrop-blur-md border-b border-gray-700/50 sticky top-0 z-50">
      <div class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <h1
              class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent cursor-pointer"
              onclick="showHomePage()">
              üéå PAnime
            </h1>
            <span class="text-sm text-gray-400">Arabic Subtitles</span>
          </div>
          <div class="flex items-center space-x-4">
            <div class="relative">
              <input type="text" id="searchInput" placeholder="Search anime..."
                class="bg-gray-800/50 border border-gray-600 rounded-lg px-4 py-2 pr-10 w-64 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                onkeypress="handleSearch(event)">
              <button onclick="performSearch()" class="absolute right-2 top-2 text-gray-400 hover:text-white">
                üîç
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
      <!-- Loading Spinner -->
      <div id="loading" class="hidden flex justify-center items-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"></div>
      </div>

      <!-- Home Page -->
      <div id="homePage">
        <div class="text-center mb-8">
          <h2
            class="text-4xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent">
            Discover Amazing Anime
          </h2>
          <p class="text-gray-300 text-lg">Watch your favorite anime with Arabic subtitles</p>
        </div>

        <!-- Anime Grid -->
        <div id="animeGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
          <!-- Anime cards will be loaded here -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center items-center space-x-4 mt-8">
          <button id="prevBtn" onclick="changePage(-1)"
            class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
            Previous
          </button>
          <span id="pageInfo" class="text-gray-300"></span>
          <button id="nextBtn" onclick="changePage(1)"
            class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
            Next
          </button>
        </div>
      </div>

      <!-- Anime Details Page -->
      <div id="detailsPage" class="hidden">
        <button onclick="showHomePage()" class="mb-6 flex items-center text-purple-400 hover:text-purple-300">
          ‚Üê Back to Home
        </button>
        <div id="animeDetails"></div>
      </div>

      <!-- Video Player Page -->
      <div id="playerPage" class="hidden">
        <button onclick="showDetailsPage()" class="mb-6 flex items-center text-purple-400 hover:text-purple-300">
          ‚Üê Back to Episodes
        </button>
        <div id="videoPlayer"></div>
      </div>
    </main>
  </div>

  <script>
    // Global variables
    let currentPage = 1;
    let currentQuery = '';
    let currentAnime = null;
    let currentEpisodes = null;
    const API_BASE = 'https://pixelll.is-a.dev/api';

    // Initialize app
    document.addEventListener('DOMContentLoaded', function () {
      loadAnimeList();
    });

    // Show/Hide loading spinner
    function showLoading(show) {
      document.getElementById('loading').classList.toggle('hidden', !show);
    }

    // Handle search
    function handleSearch(event) {
      if (event.key === 'Enter') {
        performSearch();
      }
    }

    function performSearch() {
      const query = document.getElementById('searchInput').value.trim();
      if (query !== currentQuery) {
        currentQuery = query;
        currentPage = 1;
        loadAnimeList();
      }
    }

    // Load anime list
    async function loadAnimeList() {
      showLoading(true);
      try {
        const url = currentQuery
          ? `${API_BASE}/anime?query=${encodeURIComponent(currentQuery)}&page=${currentPage}`
          : `${API_BASE}/anime?page=${currentPage}`;

        const response = await fetch(url);
        const data = await response.json();

        displayAnimeGrid(data);
        updatePagination();
      } catch (error) {
        console.error('Error loading anime:', error);
        document.getElementById('animeGrid').innerHTML = '<div class="col-span-full text-center text-red-400">Error loading anime. Please try again.</div>';
      } finally {
        showLoading(false);
      }
    }

    // Display anime grid
    function displayAnimeGrid(animeList) {
      const grid = document.getElementById('animeGrid');

      if (!animeList || animeList.length === 0) {
        grid.innerHTML = '<div class="col-span-full text-center text-gray-400">No anime found.</div>';
        return;
      }

      grid.innerHTML = animeList.map(anime => `
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-lg overflow-hidden hover:transform hover:scale-105 transition-all duration-300 cursor-pointer border border-gray-700/50 hover:border-purple-500/50" onclick="showAnimeDetails('${anime.slug}')">
                    <div class="aspect-[3/4] relative">
                        <img src="${anime.poster}" alt="${anime.title_en}" class="w-full h-full object-cover">
                        <div class="absolute top-2 right-2 bg-purple-600/90 text-white px-2 py-1 rounded-full text-xs">
                            ${anime.rating}/100
                        </div>
                        <div class="absolute bottom-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-xs">
                            ${anime.episodes} episodes
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2 line-clamp-2">${anime.title_en}</h3>
                        <p class="text-gray-400 text-sm mb-2">${anime.title_jp}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs bg-gray-700 px-2 py-1 rounded">${anime.type}</span>
                            <span class="text-xs ${anime.status === 'FINISHED' ? 'text-green-400' : 'text-yellow-400'}">${anime.status}</span>
                        </div>
                    </div>
                </div>
            `).join('');
    }

    // Update pagination
    function updatePagination() {
      document.getElementById('pageInfo').textContent = `Page ${currentPage}`;
      document.getElementById('prevBtn').disabled = currentPage <= 1;
    }

    // Change page
    function changePage(direction) {
      currentPage += direction;
      if (currentPage < 1) currentPage = 1;
      loadAnimeList();
    }

    // Show anime details
    async function showAnimeDetails(slug) {
      showLoading(true);
      try {
        // Get anime details
        const animeResponse = await fetch(`${API_BASE}/anime/${slug}`);
        currentAnime = await animeResponse.json();

        // Get episodes
        const episodesResponse = await fetch(`${API_BASE}/anime/${slug}/episodes`);
        currentEpisodes = await episodesResponse.json();

        displayAnimeDetails();

        // Hide home page and show details page
        document.getElementById('homePage').classList.add('hidden');
        document.getElementById('detailsPage').classList.remove('hidden');
        document.getElementById('playerPage').classList.add('hidden');

      } catch (error) {
        console.error('Error loading anime details:', error);
        alert('Error loading anime details. Please try again.');
      } finally {
        showLoading(false);
      }
    }

    // Display anime details
    function displayAnimeDetails() {
      const episodesList = Object.keys(currentEpisodes).map(ep => {
        const qualities = Object.keys(currentEpisodes[ep]);
        return `
                    <div class="bg-gray-800/50 rounded-lg p-4 hover:bg-gray-700/50 transition-colors">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold">Episode ${ep}</h4>
                            <div class="flex space-x-2">
                                ${qualities.map(quality => `
                                    <button onclick="playEpisode('${currentAnime.slug}', ${ep}, '${quality}')" 
                                            class="px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded text-sm transition-colors">
                                        ${quality}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
      }).join('');

      document.getElementById('animeDetails').innerHTML = `
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="md:col-span-1">
                        <img src="${currentAnime.cover}" alt="${currentAnime.title_en}" class="w-full rounded-lg shadow-lg">
                    </div>
                    <div class="md:col-span-2">
                        <h2 class="text-3xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-cyan-400 bg-clip-text text-transparent">
                            ${currentAnime.title_en}
                        </h2>
                        <h3 class="text-xl text-gray-400 mb-4">${currentAnime.title_jp}</h3>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <span class="text-gray-400">Episodes:</span>
                                <span class="font-bold ml-2">${currentAnime.episodes}</span>
                            </div>
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <span class="text-gray-400">Rating:</span>
                                <span class="font-bold ml-2">${currentAnime.rating}/100</span>
                            </div>
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <span class="text-gray-400">Type:</span>
                                <span class="font-bold ml-2">${currentAnime.type}</span>
                            </div>
                            <div class="bg-gray-800/50 rounded-lg p-4">
                                <span class="text-gray-400">Status:</span>
                                <span class="font-bold ml-2 ${currentAnime.status === 'FINISHED' ? 'text-green-400' : 'text-yellow-400'}">${currentAnime.status}</span>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold mb-2">Story</h4>
                            <p class="text-gray-300 leading-relaxed">${currentAnime.story}</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8">
                    <h3 class="text-2xl font-bold mb-4">Episodes</h3>
                    <div class="grid gap-4">
                        ${episodesList}
                    </div>
                </div>
            `;
    }

    // Play episode
    async function playEpisode(slug, episode, quality) {
      const servers = currentEpisodes[episode][quality];
      const serverOptions = Object.keys(servers).map(server => `
                <button onclick="loadVideo('${slug}', ${episode}, '${quality}', '${server}')" 
                        class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded transition-colors">
                    ${server === 'AY' ? 'Animeiat' : 'Animeblkom'}
                </button>
            `).join('');

      document.getElementById('videoPlayer').innerHTML = `
                <div class="bg-gray-800/50 rounded-lg p-6">
                    <h3 class="text-2xl font-bold mb-4">${currentAnime.title_en} - Episode ${episode}</h3>
                    
                    <div class="mb-4">
                        <h4 class="text-lg font-semibold mb-2">Select Server:</h4>
                        <div class="flex space-x-4">
                            ${serverOptions}
                        </div>
                    </div>
                    
                    <div id="videoContainer" class="aspect-video bg-black rounded-lg flex items-center justify-center">
                        <p class="text-gray-400">Select a server to start watching</p>
                    </div>
                </div>
            `;

      showPlayerPage();
    }

    // Load video
    function loadVideo(slug, episode, quality, server) {
      const streamUrl = `${API_BASE}/stream/${slug}/${episode}/${quality}/${server}`;

      document.getElementById('videoContainer').innerHTML = `
                <video controls class="w-full h-full rounded-lg" autoplay>
                    <source src="${streamUrl}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            `;
    }

    // Navigation functions
    function showHomePage() {
      document.getElementById('homePage').classList.remove('hidden');
      document.getElementById('detailsPage').classList.add('hidden');
      document.getElementById('playerPage').classList.add('hidden');
    }

    function showDetailsPage() {
      document.getElementById('homePage').classList.add('hidden');
      document.getElementById('detailsPage').classList.remove('hidden');
      document.getElementById('playerPage').classList.add('hidden');
    }

    function showPlayerPage() {
      document.getElementById('homePage').classList.add('hidden');
      document.getElementById('detailsPage').classList.add('hidden');
      document.getElementById('playerPage').classList.remove('hidden');
    }
  </script>
</body>

</html>
